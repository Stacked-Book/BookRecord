# 웹 서버의 IP 주소를 DNS 서버에 조회한다.

## IP 주소의 기본

1. HTTP 메시지를 만들면 OS에 의뢰해 접근 대상 웹 서버에 전송한다.
2. TCP/IP는 허브에 접속하고 있는 서브넷과 라우터로 네트워크가 구성되어 있다.
3. 네트워크 번호와 호스트 번호를 합쳐 IP 주소라 말한다. IP 주소에 따라 접속 대상의 위치를 판단하고 운반한다. 
    
    ![192.168.0이 네트워크 번호가 되고, 39가 호스트 번호가 된다.](%E1%84%8B%E1%85%B0%E1%86%B8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20IP%20%E1%84%8C%E1%85%AE%E1%84%89%E1%85%A9%E1%84%85%E1%85%B3%E1%86%AF%20DNS%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%A6%20%E1%84%8C%E1%85%A9%E1%84%92%E1%85%AC%E1%84%92%E1%85%A1%E1%86%AB%E1%84%83%E1%85%A1%20b925c58c47e4455892be8ca73aa27040/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-06-02_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_9.49.12.png)
    
    192.168.0이 네트워크 번호가 되고, 39가 호스트 번호가 된다.
    
4. 넷마스크를 이용해 네트워크를 구축할 때, IP 주소의 내역을 사용자가 직접 결정할 수 있다.
    
    ![0xffffff00은 Bits로는 24, Dotted Decimal로는 255.255.255.0을 의미한다.](%E1%84%8B%E1%85%B0%E1%86%B8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20IP%20%E1%84%8C%E1%85%AE%E1%84%89%E1%85%A9%E1%84%85%E1%85%B3%E1%86%AF%20DNS%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%A6%20%E1%84%8C%E1%85%A9%E1%84%92%E1%85%AC%E1%84%92%E1%85%A1%E1%86%AB%E1%84%83%E1%85%A1%20b925c58c47e4455892be8ca73aa27040/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-06-02_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_9.49.48.png)
    
    0xffffff00은 Bits로는 24, Dotted Decimal로는 255.255.255.0을 의미한다.
    
5. 호스트번호가 모두 1이면 브로드캐스트를 나타낸다. 
    
    ![마지막 호스트 번호가 255이므로 모두 1인 브로드캐스트이다.](%E1%84%8B%E1%85%B0%E1%86%B8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20IP%20%E1%84%8C%E1%85%AE%E1%84%89%E1%85%A9%E1%84%85%E1%85%B3%E1%86%AF%20DNS%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%A6%20%E1%84%8C%E1%85%A9%E1%84%92%E1%85%AC%E1%84%92%E1%85%A1%E1%86%AB%E1%84%83%E1%85%A1%20b925c58c47e4455892be8ca73aa27040/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-06-02_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_9.56.08.png)
    
    마지막 호스트 번호가 255이므로 모두 1인 브로드캐스트이다.
    
   >  💡 호스트 번호가 모두 0일 경우, 서브넷 자체를 나타내고, 1일 경우 브로드캐스트를 나타낸다.
    

## 도메인명과 IP 주소를 구분해 사용하는 이유

도메인 명을 주소로 사용하게 되면 기존 32 비트만 사용하는 주소가 255바이트까지 사용하면서 라우터의 부하가 발생해 네트워크의 속도가 느려지기 때문에 실행 효율이 좋지 않다. 그래서 DNS을 적용해 도메인 명으로 검색할 경우 DNS에서 해당 도메인 명의 주소를 검색해준다.

## Socket 라이브러리가 IP 주소를 찾는 기능을 제공한다.

1. 서버는 DNS 리졸버(DNS 클라이언트)에서 네임 리졸루션(IP 주소를 조사하는 행동)을 요청한다. 
2. DNS 리졸버는 소켓 라이브러리로 구현되어 있다.
3. 소켓 라이브러리는 네트워크의 기능을 호출하기 위한 프로그램 부품집이다.

## 리졸버를 이용해 DNS 서버를 조회한다.

리졸버를 호출하면 DNS 서버에 조회 메시지를 보내고 DNS 서버에 IP 주소 정보가 포함된 응답 메시지가 돌아온다. **브라우저가 웹 서버에 메시지를 보낼 때에는 메모리 영역에서 IP 주소를 추출해 HTTP 리퀘스트 메시지와 함께 OS에 건네줘 송신을 의뢰한다.**

```mermaid
sequenceDiagram
	Client -->> DNS Client : gethosname("www.naver.com")
	DNS Client -->> DNS Server : 주소 요청
	DNS Server -->> DNS Server : 주소 조회
	DNS Server ->> DNS Client : 주소 응답
	DNS Client ->> Client : IP Address 반환
	Client -->> Server : Http Request Message
```

## 리졸버 내부 작동

> 💡 OS의 동작은 Sync이고, Blocking이다.


브라우저가 리졸버를 호출하면 제어가 리졸버의 내부로 넘어가게 된다. 즉, 동기화가 발생해 DNS에서 응답이 오지 않는 이상 브라우저는 동작이 일시적으로 정지하게 된다.

이 때, 메시지 송신 동작은 리졸버가 스스로 실행하는 것이 아닌 OS 내부에 포함된 프로토콜 스택을 호출해 실행을 의뢰한다.

```mermaid
sequenceDiagram
	Browser -->>  Socket : 제어권 양도 <br> gethosname("www.naver.com")
	Socket ->> Socket : 조회 메시지를 생성
	Socket -->> OS : 조회 메시지를 송신 요청
	OS -->> DNS : 조회 메시지 수신
	DNS ->> DNS : IP 주소 조회
	DNS ->> OS : 응답 메시지 송신
	OS ->> Socket : 응답 메시지를 수신 응답
	Socket ->> Socket : IP 주소 추출해 메모리 영역에 저장
	Socket -> Browser : 제어권 반환
```

### 컴퓨터에서 DNS 서버 설정

DNS 서버의 IP 주소는 TCP/IP 설정 항목이므로 컴퓨터에 미리 설정되어 있고, 리졸버는 해당 정보를 통해 DNS 서버의 IP 주소에 조회 메시지를 송신한다.

![스크린샷 2022-06-02 오전 10.25.16.png](%E1%84%8B%E1%85%B0%E1%86%B8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20IP%20%E1%84%8C%E1%85%AE%E1%84%89%E1%85%A9%E1%84%85%E1%85%B3%E1%86%AF%20DNS%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%A6%20%E1%84%8C%E1%85%A9%E1%84%92%E1%85%AC%E1%84%92%E1%85%A1%E1%86%AB%E1%84%83%E1%85%A1%20b925c58c47e4455892be8ca73aa27040/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-06-02_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_10.25.16.png)
