# HTTP 리퀘스트 메시지를 작성한다.

## 탐험 여행은 URL 입력부터 시작한다.

![스크린샷 2022-06-01 오후 10.54.42.png](HTTP%20리퀘스트%20메시지를%20작성한다%20f9acc491a6e7400cbe522575d3be658b/스크린샷_2022-06-01_오후_10.54.42.png)

**URL**(Uniform Resource Locator)은 인터넷에서 웹 페이지, 이미지, 비디오 등 리소스의 위치를 가리키는 문자열이다. URL을 통해 엑세스 할 때의 프로토콜 종류와 경로를 알 수 있다. 엑세스 프로토콜에는 http, ftp, file, mailto 등이 있다.

[What is a URL? - Web 개발 학습하기 | MDN](https://developer.mozilla.org/ko/docs/Learn/Common_questions/What_is_a_URL)

### 스키마 또는 프로토콜

![스크린샷 2022-06-01 오후 10.38.39.png](HTTP%20리퀘스트%20메시지를%20작성한다%20f9acc491a6e7400cbe522575d3be658b/스크린샷_2022-06-01_오후_10.38.39.png)

`http://` 는 프로토콜 종류이고, 사용자의 요청을 받은 브라우저가 사용해야 하는 프로토콜을 나타낸다. 그리고 추가적인 스키마는 다음과 같다.

| 설명          | 설명                     |
|-------------|------------------------|
| data        | 데이터 URIs               |
| file        | 호스트가 지정하는 파일 이름들       |
| ftp         | 파일 전송 프로토콜             |
| http, https | 하이퍼텍스트 전송 프로토콜 (보안)    |
| mailto      | 전자 메일 주소               |
| ssh         | 보안 쉘                   |
| tel         | 전화번호                   |
| urn         | Uniform Resource Names |
| view-source | 리소스의 소스 코드             |
| ws, wss     | (암호화된) 웹소켓 연결          |

### 도메인 이름

![스크린샷 2022-06-01 오후 10.38.54.png](HTTP%20리퀘스트%20메시지를%20작성한다%20f9acc491a6e7400cbe522575d3be658b/스크린샷_2022-06-01_오후_10.38.54.png)

네임스페이스를 관리하는 도메인 이름 혹은 권한을 의미한다. 해당 영역을 통해 어떤 웹 서버가 요청을 받게 될지 알 수 있다.  혹은, IP 주소를 직접 사용할 수도 있지만, 불편하기 때문에 도메인 이름을 사용한다.

### 포트 번호

![스크린샷 2022-06-01 오후 10.39.03.png](HTTP%20리퀘스트%20메시지를%20작성한다%20f9acc491a6e7400cbe522575d3be658b/스크린샷_2022-06-01_오후_10.39.03.png)

웹 서버 상의 리소스에 접근하는데 사용되는 기술적인 GATE를 나타낸다. 표준 포트(HTTP는 80, HTTPS는 443)를 사용하는 경우 일반적으로 생략되지만 표준 포트가 아니라면 포트 입력은 필수다.

### 파일 경로

![스크린샷 2022-06-01 오후 10.39.12.png](HTTP%20리퀘스트%20메시지를%20작성한다%20f9acc491a6e7400cbe522575d3be658b/스크린샷_2022-06-01_오후_10.39.12.png)

웹 서버 상의 리소스 경로를 의미한다. 해당 경로는 웹 서버 상에 있는 파일의 실제 위치를 나타내지만, 현재는 대부분 **물리적인 실제 위치를 사용하지 않고 웹 서버에 의해 다뤄지는 추상화된 경로에 의해 표현이 된다.**

### 쿼리 스트링

![스크린샷 2022-06-01 오후 10.39.20.png](HTTP%20리퀘스트%20메시지를%20작성한다%20f9acc491a6e7400cbe522575d3be658b/스크린샷_2022-06-01_오후_10.39.20.png)

웹 서버에 제공되는 추가적인 파라미터이고, `&` 심볼로 구분되는 키/값 쌍의 목록이다. 웹 서버는 리소스를 사용자에게 반환하기 이전 추가적인 작업을 파라미터로 표현한다.

각각의 웹 서버는 파라메터들을 따르는 자신만의 규칙을 가지며, 특정 웹서버가 파라메터들을 다루는 방식을 알기 위한 신뢰할 수 있는 유일한 방법은 웹 서버 소유자에게 요청하는 것이다.

### 프래그먼트

![스크린샷 2022-06-01 오후 10.39.29.png](HTTP%20리퀘스트%20메시지를%20작성한다%20f9acc491a6e7400cbe522575d3be658b/스크린샷_2022-06-01_오후_10.39.29.png)

리소스 자체의 다른 부분을 가리키는 앵커(북마크)이고, 북마크된 지점의 컨텐츠를 보여준다. 아래 예를 보면 최근 문서들은 프래그먼트를 사용해 북마크된 지점으로 이동할 수 있도록 도와준다.

![스크린샷 2022-06-01 오후 10.53.19.png](HTTP%20리퀘스트%20메시지를%20작성한다%20f9acc491a6e7400cbe522575d3be658b/스크린샷_2022-06-01_오후_10.53.19.png)

**Clean URL** 은 비전문가에게 즉각적이고 직관적으로 의미를 부여함으로써 웹 서비스의 사용성과 접근성을 개선하기 위한 방법이다. 그 중, **RESTful URLs**도 존재한다.

[Clean URL - Wikipedia](https://en.wikipedia.org/wiki/Clean_URL)

## 브라우저는 먼저 URL을 해독한다.

브라우저가 하는 일은 웹 서버에 보내는 리퀘스트의 메시지를 작성하기 위해 URL을 해독하는 일이다.

![URL 해독](HTTP%20리퀘스트%20메시지를%20작성한다%20f9acc491a6e7400cbe522575d3be658b/Untitled.png)

URL 해독

아래의 방법은 절대 경로를 통해 리소스를 찾는 방법이다.
![/dir1/file1.html이라는 경로명의 파일](HTTP%20리퀘스트%20메시지를%20작성한다%20f9acc491a6e7400cbe522575d3be658b/Untitled 1.png)

/dir1/file1.html이라는 경로명의 파일

> 💡 요청을 전송하고 응답을 받는 역할을 OS에서 진행하고, 리퀘스트 메시지를 분석하는 역할은 서버에서 진행한다. 스프링에서 `ViewControllerRegistry` 가 `urlPathOrPattern` 인자를 받아 URL 매핑을 진행해 URL 목록을 스프링 컨테이너에 저장한다.
> ![스크린샷 2022-06-01 오후 2.57.16.png](HTTP%20리퀘스트%20메시지를%20작성한다%20f9acc491a6e7400cbe522575d3be658b/)


### 파일명을 생략하는 경우

1. 파일명을 생략한 경우
    
    URL이 슬래시(`/`)로 끝나는 경우는 `/dir/` 다음에 써야할 파일명을 생략한다는 의미다. URL의 규칙에는 이와 같이 파일명을 생략해도 좋다. 
    
    > 💡 파일명을 쓰지 않으면 어느 파일에 엑세스할지 모르기 때문에 파일명을 생략할 때를 대비해 파일명을 미리 서버측에 설정해둔다.
    
    
2. 디렉토리 명까지 생략하는 경우
    
    디렉토리까지 생략하게 되면 무엇을 요청하는지 몰라 지나친 생략이 될 수 있지만, 인정되고 있다.
    
    >     🌐 http://www.cyber.co.kr
    
    
3. 슬래시(`/`)를 생략한 경우
    
    맨 끝에 슬래시(`/`)가 없는 경우에는 파일 명이 whatisthis인 파일을 찾고, 없으면 디렉토리 명이 whatisthis인 디렉토리를 찾는다.  
    
    >       🌐 http://www.cyber.co.kr/whatisthis
    
4. HTTP의 기본 개념
    
    URL을 해독하면 어디에 접근하는지 판명된다. 그러면 HTTP 프로토콜을 사용하여 웹 서버에 접근하게 된다.
    
    HTTP 프로토콜은 클라이언트와 서버가 주고받는 메시지의 내용이나 순서를 정한 것이다. 프로토콜에는 무엇을(**URI로 명명한 리소스를**) 어떻게 보낼지(**메서드**) 결정해 요청 메시지를 보내면 서버는 요구에 따라 동작하고, 결과 데이터(**상태 코드**)를 응답 메시지에 저장한다.
    

### 메서드

[HTTP 요청 메서드 - HTTP | MDN](https://developer.mozilla.org/ko/docs/Web/HTTP/Methods)

- GET - URI로 지정한 정보를 도출한다.
- POST - 클라이언트에서 서버로 데이터를 송신한다.
- HEAD - GET과 거의 같지만, 헤더만 반송한다.
- OPTOINS - 통신 옵션을 통지하거나 조사할 때 사용한다.
- PUT - URI로 지정한 서버의 파일을 치환한다.
    
    💡 PUT은 리소스가 없으면 생성하고, 리소스가 있으면 대체한다. 이 때, 완벽하게 대체하기 때문에 부분 수정이 불가능하다.
    
- PATCH - URI로 지정한 서버의 리소스를 부분 변경한다.
- DELETE - URI로 지정한 서버의 파일을 삭제한다.
- TRACE - 서버측에서 받은 리퀘스트 라인과 헤더를 그대로 클라이언트에 반송한다.
- CONNECT - 암호화한 메시지를 프록시로 전송할 때, 이용하는 메서드다.

> 💡 조회 데이터는 최대한 GET, 새 리소스를 생성하거나 프로세스를 처리 아니면 어쩔 수 없는 경우는 POST를 사용 (POST를 이용해 캐싱하기가 정말 힘들기 때문에 조회는 GET을 이용)

### HTTP 메서드의 속성

- 안전 (Safe Methods)
- 멱등 (Indempotent Methods)
- 캐시가능 (Cacheable Methods)

| HTTP 메소드 | RFC      | 요청에 Body가 있음 | 응답에 Body가 있음 | 안전   | 멱등(Idempotent) | 캐시 가능 |
|----------|----------|--------------|--------------|------|----------------|-------|
| TRACE    | RFC 7231 | 아니요          | 예            | 예    | 예              | 아니요   |
| PUT      | RFC 7231 | 예            | 예            | 아니요  | 예              | 아니요   |
| POST     | RFC 7231 | 예            | 예            | 아니요  | 아니요            | 예     |
| PATCH    | RFC 5789 | 예            | 예            | 아니요  | 아니요            | 예     |
| OPTIONS  | RFC 7231 | 선택 사항        | 예            | 예    | 예              | 아니요   |
| HEAD     | RFC 7231 | 아니요          | 아니요          | 예    | 예              | 예     |
| GET      | RFC 7231 | 아니요          | 예            | 예    | 예              | 예     |
| DELETE   | RFC 7231 | 아니요          | 예            | 아니요  | 예              | 아니요   |
| CONNECT  | RFC 7231 | 예            | 예            | 아니요  | 아니요            | 아니요   |

![스크린샷 2022-06-01 오후 11.12.58.png](HTTP%20리퀘스트%20메시지를%20작성한다%20f9acc491a6e7400cbe522575d3be658b/스크린샷_2022-06-01_오후_11.12.58.png)

### 멱등

멱등은 한 번 호출하든 두 번 호출하든 100번 호출하든 결과가 같을 때 멱등이라는 성질을 가진다고 한다.

- GET : 한 번 조회해도 두 번 조회해도 같은 결과가 조회된다.
- PUT : 결과를 대체한다. 따라서 같은 요청을 여러번 해도 최종 결과는 같다.
- DELETE : 결과를 삭제한다. 같은 요청을 여러 번 해도 삭제된 결과는 똑같다.
- **POST : 멱등이 아니다. 두 번 호출하면 같은 결제가 중복해서 발생할 수 있다.**

### 멱등의 활용

- 자동 복구 메커니즘
- **서버가 TIMEOUT 등으로 정상 응답을 못줄 때, 클라이언트가 같은 요청을 다시 해도 되는가의 판단 근거가 된다.**

> 💡 **멱등은 외부 요인으로 중간에 리소스가 변경되는 것 까지 고려하지 않기 때문에** 만약 재요청 중간에 다른 곳에서 리소스를 변경해버리면 값이 변경된다.

1. HTTP 요청 메시지와 응답 메시지를 작성한다.
    
    ![스크린샷 2022-06-01 오후 10.37.10.png](HTTP%20리퀘스트%20메시지를%20작성한다%20f9acc491a6e7400cbe522575d3be658b/스크린샷_2022-06-01_오후_10.37.10.png)
    
    [HTTP 메시지 - HTTP | MDN](https://developer.mozilla.org/ko/docs/Web/HTTP/Messages)
    
    HTTP 공통적인 요청과 응답 구조
    
    1. 시작 줄(start-line)에는 실행되어야 할 요청, 또은 요청 수행에 대한 성공 또는 실패가 기록되어 있, 항상 한 줄로 끝난다.
    2. 옵션으로 HTTP 헤더 세트가 들어가고, 요청에 대한 설명, 혹은 메시지 본문에 대한 설명이 들어간다.
    3. **요청에 대한 모든 메타 정보가 전송되었음을 알리는 빈 줄(blank line)이 삽입된다.**
    4. 요청과 관련된 내용(HTML 폼 콘텐츠 등)이 옵션으로 들어가거나, 응답과 관련된 문서(document)가 들어간다. **본문의 존재 유무 및 크기는 첫 줄과 HTTP 헤더에 명시된다.**

## HTTP 리퀘스트 메시지를 작성한다.

![스크린샷 2022-06-01 오후 11.21.48.png](HTTP%20리퀘스트%20메시지를%20작성한다%20f9acc491a6e7400cbe522575d3be658b/스크린샷_2022-06-01_오후_11.21.48.png)

### 시작 라인(Request Line)

HTTP 요청은 서버가 특정 동작을 취하게끔 만들기 위해 클라이언트에서 전송하는 메시지이다. 시작 줄은 HTTP 메서드, URL, HTTP 버전의 정보가 포함되어 있다.

- HTTP 메서드
- URL
- HTTP 버전 정보

### 헤더(Message Header)

대소문자 구분없는 문자열 다음에 콜론(`':'`)이 붙으며, 그 뒤에 오는 값은 헤더에 따라 달라진다. 헤더는 값까지 포함해 한 줄로 구성되지만 꽤 길어질 수 있다.

요청 헤드 필드의 종류는 아래 글에 정리되어 있다.

[HTTP 헤더 - HTTP | MDN](https://developer.mozilla.org/ko/docs/Web/HTTP/Headers)

### 본문(Message Content)

본문은 요청의 마지막 부분에 들어가지만, 모든 요청에 본문이 들어가지는 않는다.

 `GET`, `HEAD`, `DELETE`, `OPTIONS` 처럼 리소스를 가져오는 요청은 보통 본문이 필요가 없다. 일부 요청은 업데이트를 하기 위해 서버에 데이터를 전송한다. 보통 `POST` 요청일 경우에 그렇다.

넓게 보면 본문은 두가지 종류로 나뉜다.

- **단일-리소스 본문(single-resource bodies)** 은 `Content-Type`와 `Content-Length`로 정의된 단일 파일로 구성된다.
- **다중-리소스 본문(multiple-resource bodies)**: 멀티파트 본문으로 구성되는 다중 리소스 본문에서는 파트마다 다른 정보를 지니게 된다. 보통 HTML FORM과 관련이 있다.

## 리퀘스트 메시지를 보내면 응답이 되돌아온다.

![스크린샷 2022-06-01 오후 11.51.44.png](HTTP%20리퀘스트%20메시지를%20작성한다%20f9acc491a6e7400cbe522575d3be658b/스크린샷_2022-06-01_오후_11.51.44.png)

### 상태 줄(Status Line)

상태 줄은 프로토콜의 버전, 상태코드, 상태 텍스트의 정보를 가지고 있다.

- 프로토콜 버전은 HTTP/1.1 과 같이 표현된다.
- 상태 코드는 요청의 성공 여부를 나타낸다.
- 상태 텍스트는 상태 코드에 관한 설명 글을 짧고 간결하게 표현해 HTTP 메시지를 이해하는 데 도음을 준다.

### 헤더(Message Header)

대소문자 구분없는 문자열 다음에 콜론(`':'`)이 붙으며, 그 뒤에 오는 값은 헤더에 따라 달라진다. 헤더는 값까지 포함해 한 줄로 구성되지만 꽤 길어질 수 있다.

### 본문(Message Content)

본문은 응답의 마지막 부분에 들어가고, 모든 응답에 본문이 들어가지 않는다. [201](https://developer.mozilla.org/ko/docs/Web/HTTP/Status/201), [204](https://developer.mozilla.org/ko/docs/Web/HTTP/Status/204)와 같은 상태 코드를 가진 응답에는 본문이 없다.

응답 본문은 세가지 종류로 나뉜다.

- 이미 길이가 알려진 단일 파일로 구성된 단일-리소스 본문은 `Content-Type`과 `Contest-Legnth`로 정의한다.
- 길이를 모르는 단일 파일로 구성된 단일-리소스 본문은 `Transfer-Encofing`이 `chunked`로 설정되어 있고, 파일은 청크로 나뉘어 인코딩 되어 있다.
- 서로 다른 정보를 담고 있는 멀티파트로 이루어진 다중 리소스 본문은 위 두 개의 경우보다 보기 어렵다. 각 파트마다 경계를 지정해 데이터를 구분한다.
