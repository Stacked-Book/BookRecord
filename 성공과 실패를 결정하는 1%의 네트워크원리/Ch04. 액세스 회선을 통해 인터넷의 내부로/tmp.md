# ADSL 기술을 이용한 액세스 회선의 구조와 동작

#### 인터넷의 기본은 가정이나 회사의 LAN과 같다 

- 인터넷은 가정이나 회사의 LAN과 비슷한 구조로 되어있으며 
중계장치간 거리, 경로표에 정보를 등록하는 부분만 다르다 

#### 회사의 네트워크와 인터넷의 차이

- 인터넷은 중계장치의 거리가 매우멀다
- 라우터의 등록정보가 수시로 바뀌기때문에 경로 등록을 자동화 해야한다
=> 통신장애, 인터넷에 새로 접속하는 회사발생 가능성 

#### 사용자와 인터넷을 연결하는 액세스 회선

액세스 회선은 인터넷과 가정,회사의 LAN을 연결하는 통신회선이다. 

인터넷 접속용 라우터의 패킷송신동작이 이더넷의 패킷송신동작과 차이점을 보인다
- 인터넷 접속용 라우터는 액세스 회선의 규칙에 따라 패킷송신 동작을 실행한다 
=> 책에서는 대표적인 액세스 회선으로 ADSL의 경우를 살펴본다

![](https://velog.velcdn.com/images/dudwls0505/post/6bfe6a08-0f1b-47fb-a27d-22ac33a10fab/image.png)


오른쪽-> 왼쪽방향으로 진행

사용자의 라우터에서 보낸 패킷이 ADSL모뎀을 거쳐 전화국에 도착하고 (DSLAM과 BAS존재)   
ADSL 사업자의 네트워크를 경유하여 프로바이더에 도착한다  



#### ADSL 모델에서 패킷을 셀로 분할한다 

![](https://velog.velcdn.com/images/dudwls0505/post/4bde5fe7-5376-4c53-94e2-a67bb6d6cd81/image.png)

리피터 허브나 스위칭 허브를 경유하여 인터넷 접속용 라우터에 도착하고 
패킷 송신까지는 이더넷의 라우터와 같다
단지 MACP헤더, PPPoE헤더 ,PPP 헤더라는 3개의 헤더가 붙게된다는점이 조금 다르다 

- 헤더를 붙인후 ADSL 모뎀에 도착(6) 하고 ADSL모뎀이 패킷을 작게 분할하여 셀에 저장한다 


> ADSL모뎀은 패킷을 셀로 분할하고 전기신호로 바꾸어 스플리터에 송신한다 


#### ADSL은 변조 방식으로 셀을 신호화한다

- 셀에 저장한후, 	거리가 떨어질수록 오류발생가능성이 높고 잡음을 제어하기 수월하게끔 사각형보다 좀더 복잡한 방식의 신호로 디지털 데이터를 변환한다

- ADSL은 여러가지 변조방식이 있으며(진폭변조, 위상변조, 직교 진폭변조 등), 직교 진폭 변조 방식을 사용한다 


#### 스플리터의 역할 

- ADSL 모뎀에서 셀이 전기신호로 변환된후 스플리터라는 장치에 들어간다 
- 사용자측에서 송신한경우 스플리터를 거쳐 나가면 전화의 음성신호와 ADSL의 신호가 함께 전화회선으로 흘러나간다
- 전화 회선에서 신호가 흘러들어온 경우엔 전화와 ADSL의 신호를 나누는 역할을 한다 


#### DSLAM을 통과하여 BAS에 도달한다

전화 케이블을 통해 전화국에 도착한 신호가 배선반,스플리터를 통과하여 DSLAM에 도착하면 (9) 
전기 신호가 디지털 데이터의 셀로 복원된다 (10) 
- DSLAM이 신호의 파형을 읽고 어느비트값에 대응하는지 판단후 디지털 데이터로 복원한다(10) 
- DSLAM은 ATM 인터페이스를 가지고있으며 분할한 패킷 셀의 형태 그대로 후방의 라우터와 주고받는다 
- DSLAM을 나온 셀이 BAS라는 패킷중계 장치에 가게되고 이때 BAS의 ATM인터페이스가 셸을 수신한다 (11)
- 셸을 수신후 원래의 패킷으로 복원한다 (12) (MAC, PPPoE헤더를 버림(13)) 
- 터널링에 필요한 터널링용 헤더를 붙여 출구를 향해 중계한다 (14)
- 패킷이 터널링용 라우터에 도착하고 (15), 터널링용 헤더를 분리하고 IP패킷을 추출하여(16), 인터넷의 내부에 중계한다(17)


> ADSL 모뎀은 패킷을셀로 분할하고 전기신호로 바꾸어 스플리터에 송신한다
BAS는 ATM 셸을 패킷으로 복원하여 인터넷 내부에 중계한다



# 액세스 회선으로 이용하는 PPP와 터널링 

액세스 회선이 진화함에따라 액세스 회선을 연결하는 라우터도 진화했는데 그것이 바로 BAS이다

- ADSL이나 FTTH의 액세스회선은 로그인을 하지않으면 인터넷에 액세스 할수없는데 이때 사용자측 전화국의 BAS가 로그인 동작의 창구역할을 하기위해 PPPoE라는 구조를 사용한다
> => 그리고 이를위해 사용자측 전화국과 프로바이더측 전화국 사이를 연결하는게 터널링이다

- PPPoE는 사용자명/패스워드를 바탕으로 PPP메시지를  이더넷의 패킷에 넣어 주고받는다 


#### 터널링 기능에 의해 프로바이더에 패킷을 전달한다

- BAS 는 본인확인의 창구역할 + 터널링이라는 개념을 사용하여 패킷을 운반하는 기능이 있다
- ADSL/FTTH 접속 서비스 사업자의 네트워크 안에 터널을 만들어 사용자와 BAS를 연결하는 액세스 회선을 연결하면 , 패킷이 사용자에서 프로바이더의 라우터까지 한개의 길로 인터넷의 내부로 들어가는 형태가 된다 

- 터널링은 TCP의 커넥션을 이용한 터널링과 캡슐화 방식의 터널링이 존재한다

#### 액세스 회선 전체의 동작

- 인터넷 접속용 라우터에 프로바이더가 할당한 사용자명, pw를 등록하면 PPPoE의 Discovery라는 구조에 따라 BAS를 찾는다 
=> ARP 와 마찬가지로 인터넷의 브로드캐스트를 이용(MAC주소를 알아낸다) 

- BAS의 MAC주소를 알고 BAS와 대화할수있게 된다 
- BAS에 PW를 보낼때 CHAP(암호화하는 방식), PAP(암호화 하지않는방식) 이있는데 라우터 설정을 통해 선택해야한다 
- BAS에서 TCP/IP의 설정정보를 통지하고 인터넷 접속용 라우터를 사용할경우엔 이 설정정보를 인터넷 접속용 라우터의 BAS측에 설정되고 패킷을 인터넷에 중계할수있는 상태가 된다

- 패킷이 BAS에 도착하면 도착한 패킷에서 MAC헤더와 PPPoE헤더를 제거하고 , PPP헤더 이후부분을 추출한후 터널링의 원리를 사용하여 패킷을 프로바이더의 라우터에 송신한다 


# 프로바이더의 내부

- ADSL이나 FTTH의 액세스회선이 POP이라는 프로바이더의 설비에 연결되어있다
- POP에서 들어온패킷이 NOC라는 설비로 모인다 


# 프로바이더를 경유하여 흐르는 패킷

- 최종목적지가 동일 프로바이더인지 다른 프로바이더인지 상관없이 모든 경로가 등록되어있기때문에 경로표에서 다음중계대상을 찾아 패킷을 보내는것을 반복하면 결국엔 웹서버측의 POP에 도착한다

#### 프로바이더끼리 경로 정보 교환하기
- 경로표에 경로 정보가 등록되는건 접속상대가 경로 정보를 알려주기때문이다 프로바이더간 서로 경로 정보를 교환하여 라우터에 자동등록하면 서로 경유지를 알리게된다. 이러한 구조를**BGP**라고한다 

![](https://velog.velcdn.com/images/dudwls0505/post/b4862355-b3b6-4169-9d4d-9ab475254685/image.png)

- 프로바이더 D가 E에게 인터넷의 경로를 전부 통지하면 E는 B,A,C등 인터넷에있는 프로바이더 전부를 볼수있게 되고여기에 패킷을 보낼수있게된다. 이것을 **트랜지트**라고한다

- 트랜지트와 다르게 자신에게 직접 접속되어있는 네트워크에 관한 경로정보만 상대에게 통지하는것을 **비트랜지트** 혹은 **피어**라고한다

### BGP 하이재킹
![](https://velog.velcdn.com/images/dudwls0505/post/fb5d2531-301e-467b-97b1-4a3ac89daae5/image.png)

그림출처: https://www.cloudflare.com/ko-kr/learning/security/glossary/bgp-hijacking/


DNS 서버가 IP주소를 제공하는 주소록 이라면 BGP는 그 길을 찾아가는 로드맵이다.   
공격자가 악의적으로 인터넷 트래픽을 재라우팅 하는경우       
가로채거나, 가짜 웹사이트로 연결되거나, 불필요하게 전세계로 이동해 페이지 로드시간이 증가할수도있다. 

https://www.zdnet.com/article/what-took-facebook-down/ 페이스북 하이재킹    
https://blog.cloudflare.com/bgp-leaks-and-crypto-currencies/ 아마존DNS쿼리를 하이재킹   
https://www.cloudflare.com/ko-kr/learning/security/glossary/bgp-hijacking/ 하이재킹에 대하여   





#### IX



5개의 프로바이더끼리 서로 접속하려고하는경우 프로바이더끼리 1:1로 접속하는경우   
모든 프로바이더와 통신회선을 연결해야한다는 문제가있다.

![](https://velog.velcdn.com/images/dudwls0505/post/29b49129-8c60-4a76-ab32-0e88307e7285/image.png)


중심이되는 설비를 설치하고 이것을 경유하여 접속하는방법을 선택하여 통신회선의수를 줄이는것을 IX라고한다 
