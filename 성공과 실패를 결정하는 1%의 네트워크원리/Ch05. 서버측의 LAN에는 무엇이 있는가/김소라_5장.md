## 01 웹 서버의 설치 장소

---

### 사내 설치

1. **라우터에 직접 연결하는 경우**

<img width="670" alt="스크린샷 2022-06-30 오후 2 40 38" src="https://user-images.githubusercontent.com/80027033/176889341-edc1d2cd-858f-4c2f-8cf1-569590eed673.png">


- 사내의 LAN에 서버를 설치하고 인터넷에 직접 액세스하는 경우
    - **패킷의 경로**

      ① 가장 가까운 POP에 있는 라우터

      ② 액세스 회선

      ③ 서버측 라우터

      ④ 서버 머신 도착

- 현재는 비주류 방법이 된 이유
    - IP 주소의 부족 : 클라이언트에도 글로벌 주소를 할당해야 함
    - 보안 문제

<br>

2. **방화벽으로 분리하는 경우**

<img width="652" alt="스크린샷 2022-06-30 오후 3 53 35" src="https://user-images.githubusercontent.com/80027033/176889498-989f5564-11c7-4358-bc1a-5c2aa9465e47.png">

- `방화벽`이 특정 서버에서 동작하는 특정 애플리케이션에 액세스하는 패킷만 통과시키고 그 외의 패킷은 차단한다.
- 애플리케이션 자체의 보안 결함은 여전히 남아있다.

<br>

### 데이터센터 설치

<img width="703" alt="스크린샷 2022-06-30 오후 4 05 49" src="https://user-images.githubusercontent.com/80027033/176889586-e61e2f1d-b47c-4840-a692-ee91af9453ab.png">

- 프로바이더 등이 운영하는 데이터센터라는 시설에 서버를 가지고 들어가서 설치

  OR 프로바이더가 소유하는 서버를 빌려쓰는 형태로 운영

- `데이터센터`는 프로바이더의 중심 부분에 있는 `NOC`에 직접 접속되었거나 `IX`에 직결되어 있다.
- **데이터센터의 부가 서비스**
    - 기기의 가동 상태 감시
    - 방화벽의 설치 운영
    - 부정 침입 감시

<br>

## 02 방화벽의 원리와 동작

---

📌 **방화벽의 유형 중 가장 많이 보급된 패킷 필터링형을 통해 원리와 동작을 탐색한다.**

<br>

<img width="1169" alt="스크린샷 2022-07-01 오후 2 51 31" src="https://user-images.githubusercontent.com/80027033/176889799-85d1f66a-a5ee-4c59-907f-7205fbdfc0df.png">

- 서버에 기생하며 다른 서버에 감염되어 가는 부정 소프트웨어를 방지하기 위해 웹 서버에서 인터넷 측에 액세스하는 것을 금지

  ① 인터넷에서 웹 서버에 대한 액세스를 허가하지 않으면

  ② 웹 서버에서 인터넷의 액세스를 금지하도록 패킷 차단

- 조건
    - **TCP/UDP헤더에 기록된 포트 번호로 애플리케이션 한정**

      수신처/송신처 IP 주소가 웹 서버의 주소와 일치하고 수신처/송신처 포트 번호가 결정된 포트 번호와 일치할 때 패킷 통과

    - **TCP 헤더에 있는 컨트롤 비트로 접속 방향 판단**

      최초의 패킷은 TCP 컨트롤 비트의 SYN이 1, ASK가 0이기 때문에 두 번째 패킷(SYN=1, ASK=1)과 구분하여 판별하고 차단

    - 수신처 IP 주소가 공개 서버용 LAN과 일치하는 패킷을 모두 통과시킨다면, **송신처 IP 주소 설정** 반드시 필요
    - 패킷의 시점과 종점을 조건으로 지정한 후 **주소 변환**이 필요한 경우에 주소 변환 실행하도록 설정(*인터넷 측에서 사내 LAN에 액세스할 수 없게 됨*)

<br>

💡 UDP는 TCP처럼 컨트롤 비트에 의해 액세스 방향을 판별할 수 없으므로 어느정도 위험을 감수하고 패킷을 전부 통과시키거나 애플리케이션을 전면적으로 차단해야 한다.

📛 **방화벽은 패킷의 내용을 조사하지 않으므로 위험한지 판단할 수 없다.**

- 대처법
    - 웹 서버 소프트웨어의 버그를 고쳐 다운되지 않도록 한다.
    - 패킷의 내용을 조사하여 위험한 데이터가 포함되어 있다면 패킷을 차단하도록 장치나 소프트웨어를 별도로 준비한다.

<br>

## 03 복수 서버에 리퀘스트를 분배한 서버의 부하 분산

---

**분산 처리**

> 복수의 서버를 사용하여 처리를 분담하는 방법으로 서버의 한 대당 처리량을 불이기 위한 방법
>
- `라운드 로빈` : 같은 서버에 대응시켜 등록된 다수의 IP 주소를 하나씩 돌아가며 1주기를 순환하는 구조
- DNS 서버는 웹 서버의 동작은 확인하지 못하므로 서버에 문제가 생겨도 IP 주소를 회답하게 된다.

<br>

**부하 분산 장치(=로드 밸런서)를 이용한 방법**

<img width="555" alt="스크린샷 2022-07-01 오후 7 22 21" src="https://user-images.githubusercontent.com/80027033/176889958-7e3f8d7b-cec5-46aa-a994-b354e201ae89.png">

- `부하 분산 장치`를 웹 서버 대신 DNS 서버에 등록한다.
- **역할**
    - **웹 서버의 부하 판단**
        - 웹 서버와 정기적으로 정보를 교환하여 CPU나 메모리의 사용률 등을 수집하여 웹 서버의 부하 판단
        - 시험 패킷을 웹 서버에 보내 응답시간으로 부하 판단
    - **전후 관계 파악 후 패킷 전송**

      리퀘스트가 같은 서버에 전송되어야 하는지 파악하여 일련의 동작이라면 이전과 동일한 웹 서버에 리퀘스트 전송, 그렇지 않으면 부하가 적은 웹 서버에 전송

<br>

## 04 캐시 서버를 이용한 서버의 부하 분산

---

> 캐시 서버는 `프록시`라는 구조를 사용하여 데이터를 캐시에 저장하는 서버이다.
>

🔎 프록시란?

**웹 서버와 클라이언트 사이에서 웹 서버에 대한 액세스 동작을 중개하는 역할**을 한다. 웹 서버에서 받은 데이터를 디스크에 저장해 두고 웹 서버를 대신해 데이터를 클라이언트에 반송한다.

- 리퀘스트의 내용을 조사한 후 전송하므로 위험한 사이트나 작업과 관계없는 사이트에 대한 액세스에 제한을 마련할 수 있다.
- 종류
    - **포워드 프록시**
        - 프록시 구조를 클라이언트측에 위치시킨다.
        - 브라우저에 프록시 서버를 설정하면 URL의 내용과 상관 없이 모든 리퀘스트가 포워드 프록시로 전달된다.
        - 패킷 왕래를 정지시키고 리퀘스트 메시지를 받아 대신 인터넷을 향해 전송한다.
    - **리버스 프록시**
        - 리퀘스트 메시지의 URI에 쓰여있는 디렉토리명과 전송 대상의 웹 서버를 대응시켜 리퀘스트 메시지를 전송한다.
    - **트랜스페어런트 프록시**
        - 리퀘스트 메시지에서 패킷의 헤더를 조사해서 액세스 대상 웹 서버의 위치를 파악한다.
        - 브라우저에서 웹 서버로 향하는 길에 프록시를 설치해야 트랜스페어런트 프록시가 패킷을 중간에 받아 처리할 수 있다.
- **추가되는 리퀘스트 헤더**
1. **via**

```
via: 1.1 proxy.lab.cyber.co.kr
```

`via` 로 캐시 서버를 경유한 사실을 웹 서버에 알린다. 단 캐시 서버의 설정에 따라 이 헤더를 추가하지 않는 경우도 있다.

1. **If-Modified-Since**

① *캐시 → 웹 서버*

```
If-Modified-Since: Wed, 21 Sep 2008 10:25:52 GMT
```

캐시에 저장되어 있는 데이터가 웹 서버측에서 변경되었는지 확인한다.

② *웹 서버 → 캐시*

```
HTTP/1.1 304 Not Modified
```

- 변경된 데이터가 없는 경우 위와 같이 변경된 사실이 없음을 알린다.
- 변경된 데이터가 있을 경우 최신의 데이터를 반송한다.

<br>

## 05 콘텐츠 배포 서비스

---

**캐시 서버의 위치**

1. 서버측에 두는 경우
    - 장점 : 웹 서버의 부하 경감, 웹 서버의 운영자가 캐시 서버 관리
    - 단점 : 인터넷을 흐르는 트래픽 억제 불가
2. 클라이언트측에 두는 경우
    - 장점 : 패킷의 흐름 안정화
    - 단점 : 웹 서버의 운영자가 캐시 서버 관리 불가

`콘텐츠 배포 서비스(CDS, Content Delivery Service)`

> `CDSP`(Content Delivery Service Provider)가 중요한 프로바이더에 다수의 캐시 서버를 설치하고 웹 서버와 이 캐시 서버를 연대해 웹 서버 운영자에게 대출하는 서비스
>

💡 CDS에서는 웹 서버의 데이터가 변경되면 즉시 캐시 서버에 내용이 반영되기 때문에 갱신 여부를 확인하지 않아도 된다.

<br>

**가까운 캐시 서버에 액세스하는 방법 1**

<img width="731" alt="스크린샷 2022-07-01 오후 8 35 57" src="https://user-images.githubusercontent.com/80027033/176890098-7a245948-d981-4112-9623-1a15d95c1120.png">

① 캐시 서버의 설치 장소에 있는 라우터에서 경로 정보를 모아둔다.

② 송신처 IP 주소와 라우터에서 모은 경로 정보로 캐시 서버와 클라이언트측의 DNS 서버의 거리를 조사한다.

③ 가장 가까운 캐시 서버의 IP 주소를 클라이언트에 회답한다.

<br>

**가까운 캐시 서버에 액세스하는 방법 2**

`리다이렉트`를 사용해 액세스 대상을 가장 가까운 캐시 서버로 돌린다.

- 장점 : 클라이언트가 보내는 HTTP 메시지의 송신처 IP 주소를 바탕으로 거리를 판단하므로 정밀도가 높다.
- 단점 : HTTP 메시지의 대화가 증가하므로 오버헤드가 많다.